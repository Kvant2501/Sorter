<Window x:Class="PhotoSorterApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PhotoSorterApp.ViewModels"
        xmlns:models="clr-namespace:PhotoSorterApp.Models"
        Title="PhotoSorter" Height="560" Width="820" ResizeMode="NoResize">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <!-- Ensure ToolTips use theme brushes so they are readable in Dark theme -->
        <Style TargetType="ToolTip">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="MaxWidth" Value="420" />
        </Style>

        <!-- Style for small help icon -->
        <Style x:Key="HelpIconStyle" TargetType="TextBlock">
            <Setter Property="Text" Value="?"/>
            <Setter Property="Width" Value="16"/>
            <Setter Property="Height" Value="16"/>
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextOnPrimaryBrush}"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="Cursor" Value="Help"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="Файл">
                <MenuItem Header="Выход" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="Справка">
                <MenuItem Header="О программе" Click="About_Click"/>
                <MenuItem Header="Поддерживаемые форматы" Click="Formats_Click"/>
                <MenuItem Header="Полная справка" Click="FullHelp_Click"/>
            </MenuItem>
            <MenuItem Header="Тема">
                <MenuItem x:Name="ThemeLightMenu" Header="Светлая" IsCheckable="True" Checked="Theme_Checked" AutomationProperties.Name="Светлая" AutomationProperties.AutomationId="ThemeLightMenu"/>
                <MenuItem x:Name="ThemeDarkMenu" Header="Тёмная" IsCheckable="True" Checked="Theme_Checked" AutomationProperties.Name="Тёмная" AutomationProperties.AutomationId="ThemeDarkMenu"/>
            </MenuItem>
        </Menu>

        <TabControl Grid.Row="1" Margin="10">
            <!-- Sorting tab -->
            <TabItem Header="Сортировка">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource CardCompact}">
                        <DockPanel LastChildFill="True">
                            <Button Style="{StaticResource FolderPickerButton}" DockPanel.Dock="Left" Content="Выбрать папку" Click="SelectFolder_Click" Width="150" Margin="0,0,10,0"/>
                            <TextBox Text="{Binding SortingOptions.SourceFolder}" Height="26" IsReadOnly="True" VerticalContentAlignment="Center"/>
                        </DockPanel>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Параметры" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,18,10">
                                    <CheckBox Content="Рекурсивный поиск" IsChecked="{Binding SortingOptions.IsRecursive}" Margin="0,0,6,0"/>
                                    <TextBlock Style="{DynamicResource HelpIconStyle}">
                                        <TextBlock.ToolTip>
                                            <ToolTip>
                                                <TextBlock TextWrapping="Wrap" MaxWidth="300">Обрабатывать все подпапки внутри выбранной папки.</TextBlock>
                                            </ToolTip>
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,0,18,10">
                                    <CheckBox Content="Разбивать по месяцам" IsChecked="{Binding SortingOptions.SplitByMonth}" Margin="0,0,6,0"/>
                                    <TextBlock Style="{DynamicResource HelpIconStyle}">
                                        <TextBlock.ToolTip>
                                            <ToolTip>
                                                <TextBlock TextWrapping="Wrap" MaxWidth="300">Создавать подпапки по месяцам (Год/Месяц).</TextBlock>
                                            </ToolTip>
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,0,18,10">
                                    <CheckBox Content="Создать бэкап" IsChecked="{Binding SortingOptions.CreateBackup}" Margin="0,0,6,0"/>
                                    <TextBlock Style="{DynamicResource HelpIconStyle}">
                                        <TextBlock.ToolTip>
                                            <ToolTip>
                                                <TextBlock TextWrapping="Wrap" MaxWidth="300">Перед сортировкой создать копию исходной папки.</TextBlock>
                                            </ToolTip>
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </StackPanel>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock x:Name="LabelFileType" Text="Тип файлов" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <RadioButton Content="Только фото" GroupName="FileType" IsChecked="{Binding IsPhotosOnly}" Checked="FileType_Checked" Tag="PhotosOnly" Margin="0,0,20,10"/>
                                <RadioButton Content="Только видео" GroupName="FileType" IsChecked="{Binding IsVideosOnly}" Checked="FileType_Checked" Tag="VideosOnly" Margin="0,0,20,10"/>
                                <RadioButton Content="Фото + видео" GroupName="FileType" IsChecked="{Binding IsPhotosAndVideos}" Checked="FileType_Checked" Tag="PhotosAndVideos" Margin="0,0,20,10"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="StartButton" Style="{StaticResource PrimaryButton}" Content="Старт" Click="StartProcess_Click" Width="140"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Documents tab -->
            <TabItem Header="Документы">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource CardCompact}">
                        <DockPanel LastChildFill="True">
                            <Button Style="{StaticResource FolderPickerButton}" DockPanel.Dock="Left" Content="Выбрать папку" Click="SelectDocumentsFolder_Click" Width="150" Margin="0,0,10,0"/>
                            <TextBox Text="{Binding DocumentsSortingOptions.SourceFolder}" Height="26" IsReadOnly="True" VerticalContentAlignment="Center"/>
                        </DockPanel>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Параметры" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <CheckBox Content="Рекурсивный поиск" IsChecked="{Binding DocumentsSortingOptions.IsRecursive}" Margin="0,0,18,10"/>
                                <CheckBox Content="Разбивать по месяцам" IsChecked="{Binding DocumentsSortingOptions.SplitByMonth}" Margin="0,0,18,10"/>
                                <CheckBox Content="Создать бэкап" IsChecked="{Binding DocumentsSortingOptions.CreateBackup}" Margin="0,0,18,10"/>
                            </WrapPanel>
                            <TextBlock Text="Структура: Расширение/Год/(Месяц)" Foreground="{DynamicResource SubtleTextBrush}" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource PrimaryButton}" Content="Старт" Click="StartDocumentsSorting_Click" Width="140"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Duplicates tab -->
            <TabItem Header="Дубликаты">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource CardCompact}">
                        <DockPanel LastChildFill="True">
                            <Button Style="{StaticResource FolderPickerButton}" DockPanel.Dock="Left" Content="Выбрать папку" Click="SelectDuplicatesFolder_Click" Width="150" Margin="0,0,10,0"/>
                            <Border Style="{StaticResource TextBoxLike}">
                                <TextBlock Text="{Binding DuplicatesSearchFolder}" TextWrapping="Wrap"/>
                            </Border>
                        </DockPanel>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Параметры" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Content="Рекурсивно" IsChecked="{Binding IsDuplicatesRecursive}" Margin="0,0,10,0">
                                    <CheckBox.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Искать дубликаты во всех подпапках.</TextBlock>
                                        </ToolTip>
                                    </CheckBox.ToolTip>
                                </CheckBox>
                                <TextBlock Style="{DynamicResource HelpIconStyle}">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Искать дубликаты во всех подпапках.</TextBlock>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Тип файлов" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <WrapPanel>
                                <RadioButton Content="Фото" GroupName="DupFileType" IsChecked="{Binding IsDuplicatesPhotosOnly}" Margin="0,0,20,10"/>
                                <RadioButton Content="Видео" GroupName="DupFileType" IsChecked="{Binding IsDuplicatesVideosOnly}" Margin="0,0,20,10"/>
                                <RadioButton Content="Фото + видео" GroupName="DupFileType" IsChecked="{Binding IsDuplicatesPhotosAndVideos}" Margin="0,0,20,10"/>
                                <RadioButton Content="Документы" GroupName="DupFileType" IsChecked="{Binding IsDuplicatesDocumentsOnly}" Margin="0,0,20,10"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource PrimaryButton}" Content="Найти дубликаты" Click="FindDuplicates_Click" Width="180"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Cleanup tab -->
            <TabItem Header="Очистка">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource CardCompact}">
                        <DockPanel LastChildFill="True">
                            <Button Style="{StaticResource FolderPickerButton}" DockPanel.Dock="Left" Content="Выбрать папку" Click="SelectCleanupFolder_Click" Width="150" Margin="0,0,10,0"/>
                            <Border Style="{StaticResource TextBoxLike}">
                                <TextBlock Text="{Binding CleanupFolder}" TextWrapping="Wrap"/>
                            </Border>
                        </DockPanel>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Параметры" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Content="Рекурсивно" IsChecked="{Binding CleanupRecursive}" Margin="0,0,10,0">
                                    <CheckBox.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Очищать все подпапки.</TextBlock>
                                        </ToolTip>
                                    </CheckBox.ToolTip>
                                </CheckBox>
                                <TextBlock Style="{DynamicResource HelpIconStyle}">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Очищать все подпапки.</TextBlock>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>

                            <WrapPanel Margin="0,10,0,0">
                                <CheckBox Content="Скриншоты" IsChecked="{Binding CleanupScreenshots}" Margin="0,0,18,10"/>
                                <CheckBox Content="Временные файлы" IsChecked="{Binding CleanupTempFiles}" Margin="0,0,18,10"/>
                                <CheckBox Content="Пустые файлы" IsChecked="{Binding CleanupEmptyFiles}" Margin="0,0,18,10"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource PrimaryButton}" Content="Старт очистки" Click="StartCleanup_Click" Width="180"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Rename tab -->
            <TabItem Header="Переименование">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Style="{StaticResource CardCompact}">
                        <DockPanel LastChildFill="True">
                            <Button Style="{StaticResource FolderPickerButton}" DockPanel.Dock="Left" Content="Выбрать папку" Click="SelectRenameFolder_Click" Width="150" Margin="0,0,10,0"/>
                            <Border Style="{StaticResource TextBoxLike}">
                                <TextBlock Text="{Binding RenameFolder}" TextWrapping="Wrap"/>
                            </Border>
                        </DockPanel>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Параметры" Style="{StaticResource HeaderText}" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Content="Рекурсивно" IsChecked="{Binding IsRenameRecursive}" Margin="0,0,10,0">
                                    <CheckBox.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Переименовывать файлы во всех подпапках.</TextBlock>
                                        </ToolTip>
                                    </CheckBox.ToolTip>
                                </CheckBox>
                                <TextBlock Style="{DynamicResource HelpIconStyle}">
                                    <TextBlock.ToolTip>
                                        <ToolTip>
                                            <TextBlock TextWrapping="Wrap" MaxWidth="300">Переименовывать файлы во всех подпапках.</TextBlock>
                                        </ToolTip>
                                    </TextBlock.ToolTip>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Border Grid.Row="2" Style="{StaticResource Card}" Margin="0,0,0,6">
                        <StackPanel>
                            <TextBlock Text="Шаблон" Style="{StaticResource HeaderText}" Margin="0,0,0,4"/>
                            <ComboBox ItemsSource="{Binding RenameTemplates}" SelectedItem="{Binding SelectedRenameTemplate}" MinWidth="300"/>
                            <TextBox Text="{Binding RenamePattern, UpdateSourceTrigger=PropertyChanged}" Margin="0,6,0,4" MinWidth="300" Height="26"/>

                            <WrapPanel Margin="0,0,0,4">
                                <Button Content="Год" Tag="{}{year}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="Месяц" Tag="{}{month}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="День" Tag="{}{day}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="Дата" Tag="{}{date}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="Счётчик" Tag="{}{index}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="Имя" Tag="{}{name}" Click="InsertBlock_Click" Margin="0,0,8,6"/>
                                <Button Content="Текст..." Click="InsertCustomText_Click" Margin="0,0,8,6"/>
                            </WrapPanel>

                            <TextBlock Text="{Binding RenamePreview}" FontStyle="Italic" Foreground="{DynamicResource SubtleTextBrush}" Margin="0,2,0,0" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,6,0,0">
                        <Button Style="{StaticResource PrimaryButton}" Content="Переименовать" Click="ApplyRename_Click" Width="160"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Log tab -->
            <TabItem Header="Лог">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Styled ListBox for log output: supports alternating row backgrounds and uses theme brushes -->
                    <ListBox Grid.Row="0" ItemsSource="{Binding Logger}"
                             Background="{DynamicResource SurfaceBrush}"
                             Foreground="{DynamicResource TextBrush}"
                             BorderThickness="0"
                             AlternationCount="2"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">

                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="4" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Style.Triggers>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="{DynamicResource BackgroundBrush}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                                    <TextBlock Text="{Binding Icon}" FontSize="14" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding Message}" VerticalAlignment="Center" TextWrapping="Wrap"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="Сохранить лог" Click="SaveLog_Click" Width="160" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>