<Window x:Class="PhotoSorterApp.Views.DuplicateWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:helpers="clr-namespace:PhotoSorterApp.Helpers"
        Title="Дубликаты" Height="700" Width="900" FontFamily="Segoe UI">

    <Window.Resources>
        <helpers:FileToPreviewConverter x:Key="FileToPreviewConverter" />

        <!-- Тень для карточек -->
        <DropShadowEffect x:Key="CardShadow" 
                          BlurRadius="8" 
                          ShadowDepth="2" 
                          Color="#80000000" 
                          Opacity="0.2" />
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Выберите файлы для удаления или перемещения. Первый файл в группе остаётся."
                   TextWrapping="Wrap" Margin="0,0,0,20" 
                   FontStyle="Italic" Foreground="#666" FontSize="14"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding DuplicateGroups}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,24,24" 
                                Padding="16" 
                                Background="White"
                                CornerRadius="8"
                                Effect="{StaticResource CardShadow}"
                                Width="350">
                            <StackPanel>
                                <TextBlock Text="{Binding Items.Count, StringFormat={}Группа ({0} файлов)}" 
                                           FontWeight="SemiBold" FontSize="14" 
                                           Margin="0,0,0,12" Foreground="#333"/>

                                <ItemsControl ItemsSource="{Binding Items}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <CheckBox IsChecked="{Binding IsSelected}" 
                                                          VerticalAlignment="Top" 
                                                          Margin="0,4,12,0"/>

                                                <Image Source="{Binding FilePath, Converter={StaticResource FileToPreviewConverter}}" 
                                                       Width="80" Height="60" Stretch="Uniform" 
                                                       Margin="0,0,12,0">
                                                    <Image.ToolTip>
                                                        <Image Source="{Binding FilePath}" 
                                                               Width="320" Height="240" Stretch="Uniform" 
                                                               RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    </Image.ToolTip>
                                                </Image>

                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding FileName}" 
                                                               FontWeight="Normal" FontSize="13" 
                                                               TextTrimming="CharacterEllipsis" MaxWidth="180"/>
                                                    <TextBlock Text="{Binding DisplaySize}" 
                                                               FontSize="11" Foreground="#888"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Кнопки с закруглёнными углами -->
        <StackPanel Orientation="Horizontal" Grid.Row="2" HorizontalAlignment="Right" Margin="0,20,0,0">
            <!-- Удалить -->
            <Border CornerRadius="4" Background="#FF5F5F" Margin="0,0,12,0">
                <Button Content="Удалить выбранные" Click="DeleteSelected_Click" 
                        Padding="16,10" Foreground="White" 
                        FontSize="14" FontWeight="Medium"
                        BorderThickness="0" Background="Transparent"/>
            </Border>

            <!-- Переместить -->
            <Border CornerRadius="4" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,0,12,0">
                <Button Content="Переместить..." Click="MoveSelected_Click" 
                        Padding="16,10" FontSize="14" FontWeight="Medium"
                        BorderThickness="0" Background="Transparent"/>
            </Border>

            <!-- Закрыть -->
            <Border CornerRadius="4" BorderBrush="#CCCCCC" BorderThickness="1">
                <Button Content="Закрыть" Click="Close_Click" 
                        Padding="16,10" FontSize="14" FontWeight="Medium"
                        BorderThickness="0" Background="Transparent"/>
            </Border>
        </StackPanel>
    </Grid>
</Window>