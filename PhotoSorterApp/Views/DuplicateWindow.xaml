<Window x:Class="PhotoSorterApp.Views.DuplicateWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:helpers="clr-namespace:PhotoSorterApp.Helpers"
        Title="Дубликаты" Height="700" Width="900" FontFamily="Segoe UI">

    <Window.Resources>
        <helpers:FileToPreviewConverter x:Key="FileToPreviewConverter" />
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Выберите файлы для удаления или перемещения. Первый файл в группе остаётся."
                   TextWrapping="Wrap" Margin="0,0,0,15" FontStyle="Italic" Foreground="#555"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding DuplicateGroups}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,20,20" Padding="12" Background="White" 
                                BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="6" Width="340">
                            <StackPanel>
                                <TextBlock Text="{Binding Items.Count, StringFormat={}Группа ({0} файлов)}" 
                                           FontWeight="SemiBold" FontSize="13" Margin="0,0,0,10"/>

                                <ItemsControl ItemsSource="{Binding Items}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <CheckBox IsChecked="{Binding IsSelected}" 
                                                          VerticalAlignment="Top" Margin="0,2,10,0"/>
                                                <!-- Расстояние 10 пикселей -->
                                                <Image Source="{Binding FilePath, Converter={StaticResource FileToPreviewConverter}}" 
                                                       Width="80" Height="60" Stretch="Uniform" Margin="0,0,8,0">
                                                    <Image.ToolTip>
                                                        <!-- Всплывающее превью — оригинального размера -->
                                                        <Image Source="{Binding FilePath}" 
                                                               Width="320" Height="240" Stretch="Uniform" 
                                                               RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    </Image.ToolTip>
                                                </Image>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding FileName}" 
                                                               FontWeight="Normal" FontSize="12" 
                                                               TextTrimming="CharacterEllipsis" MaxWidth="180"/>
                                                    <TextBlock Text="{Binding DisplaySize}" 
                                                               FontSize="10" Foreground="#777"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <StackPanel Orientation="Horizontal" Grid.Row="2" HorizontalAlignment="Right">
            <Button Content="Удалить выбранные" Click="DeleteSelected_Click" 
                    Padding="14,8" Background="#FF5F5F" Foreground="White" Margin="0,0,10,0"/>
            <Button Content="Переместить..." Click="MoveSelected_Click" 
                    Padding="14,8" Margin="0,0,10,0"/>
            <Button Content="Закрыть" Click="Close_Click" Padding="14,8"/>
        </StackPanel>
    </Grid>
</Window>