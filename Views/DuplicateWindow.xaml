<Window x:Class="PhotoSorterApp.Views.DuplicateWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:helpers="clr-namespace:PhotoSorterApp.Helpers"
        Title="Дубликаты" Height="700" Width="1000" FontFamily="Segoe UI">

    <Window.Resources>
        <helpers:FileToPreviewConverter x:Key="FileToPreviewConverter" />
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Выберите файлы для удаления или перемещения. Первый файл в группе остаётся."
                   TextWrapping="Wrap" Margin="0,0,0,15" FontStyle="Italic" Foreground="#555"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding DuplicateGroups}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,20,20" Padding="15" Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Width="450">
                            <StackPanel>
                                <TextBlock Text="{Binding Items.Count, StringFormat={}Группа ({0} файлов)}" 
                                           FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>

                                <!-- Два столбца для файлов внутри группы -->
                                <ItemsControl ItemsSource="{Binding Items}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F9F9F9" Margin="0,0,10,10" Padding="8" CornerRadius="4" Width="210">
                                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                    <CheckBox IsChecked="{Binding IsSelected}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                    <Image Source="{Binding FilePath, Converter={StaticResource FileToPreviewConverter}}" 
                                                           Width="60" Height="45" Stretch="Uniform" Margin="0,0,8,0">
                                                        <Image.ToolTip>
                                                            <Image Source="{Binding FilePath, Converter={StaticResource FileToPreviewConverter}}" 
                                                                   Width="300" Stretch="Uniform"/>
                                                        </Image.ToolTip>
                                                    </Image>
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding FileName}" FontWeight="Bold" FontSize="12" TextTrimming="CharacterEllipsis" MaxWidth="120"/>
                                                        <TextBlock Text="{Binding DisplaySize}" FontSize="11" Foreground="#777"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <StackPanel Orientation="Horizontal" Grid.Row="2" HorizontalAlignment="Right">
            <Button Content="Удалить выбранные" Click="DeleteSelected_Click" 
                    Padding="14,8" Background="#FF5F5F" Foreground="White" Margin="0,0,10,0"/>
            <Button Content="Переместить..." Click="MoveSelected_Click" 
                    Padding="14,8" Margin="0,0,10,0"/>
            <Button Content="Закрыть" Click="Close_Click" Padding="14,8"/>
        </StackPanel>
    </Grid>
</Window>